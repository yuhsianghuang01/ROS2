<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>NFS æ›è¼‰ä½¿ç”¨æ•™å­¸èˆ‡å¸¸è¦‹å•é¡Œè™•ç†</title>
  <style>
    body { font-family: Arial, sans-serif; line-height: 1.6; max-width: 900px; margin: auto; padding: 20px; }
    h1, h2, h3 { color: #2c3e50; }
    code { background-color: #f4f4f4; padding: 2px 6px; border-radius: 4px; }
    pre { background-color: #f4f4f4; padding: 10px; border-radius: 5px; overflow-x: auto; }
    .highlight { background-color: #fff9c4; padding: 10px; border-left: 4px solid #fbc02d; }
  </style>
</head>
<body>

<h1>ç•¶åŸ·è¡Œ NFS æ›è¼‰æ™‚å‡ºç¾ permission / Operation not permitted æ™‚çš„è§£æ±ºæ–¹æ³•</h1>

<p>ç•¶æ‚¨åœ¨åŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤æ™‚ï¼š</p>

<pre><code>sudo mount -t nfs 192.168.0.100:/home/wheeltec/wheeltec_robot  /mnt</code></pre>

<p>å‡ºç¾éŒ¯èª¤è¨Šæ¯é¡ä¼¼ï¼š</p>

<pre><code>mount failed: Operation not permitted</code></pre>

<p>é€™é€šå¸¸ä¸æ˜¯ Linux ç«¯çš„æ¬Šé™å•é¡Œï¼Œè€Œæ˜¯ <strong>NFS Server</strong>ï¼ˆä¹Ÿå°±æ˜¯ <code>192.168.0.100</code>ï¼‰æ²’æœ‰å…è¨±æ‚¨çš„å®¢æˆ¶ç«¯æ›è¼‰é€™å€‹ç›®éŒ„ã€‚ä»¥ä¸‹æ˜¯å¸¸è¦‹åŸå› èˆ‡è§£æ±ºæ–¹æ³•ã€‚</p>

<hr>

<h2>ğŸ” å¸¸è¦‹åŸå› èˆ‡è§£æ±ºæ–¹å¼</h2>

<h3>âœ… 1. æª¢æŸ¥ NFS Server æ˜¯å¦æ­£ç¢ºå°å‡ºè©²ç›®éŒ„</h3>

<p>åœ¨ NFS Server ç«¯ï¼ˆå³ <code>192.168.0.100</code>ï¼‰ï¼Œè«‹æª¢æŸ¥ <code>/etc/exports</code> çš„å…§å®¹ï¼š</p>

<pre><code>cat /etc/exports</code></pre>

<p>æ‡‰è©²è¦æœ‰é¡ä¼¼é€™æ¨£çš„æ¢ç›®ï¼š</p>

<pre><code>/home/wheeltec/wheeltec_robot 192.168.0.0/24(rw,sync,no_subtree_check)</code></pre>

<p>å¦‚æœæ²’æœ‰é€™å€‹ç›®éŒ„æˆ– IP ç¯„åœä¸å°ï¼Œå°±ç„¡æ³•æ›è¼‰ã€‚</p>

<div class="highlight">
  <p>ğŸ› ï¸ è§£æ±ºæ–¹æ³•ï¼š</p>
  <ol>
    <li>ä¿®æ”¹ <code>/etc/exports</code> åŠ å…¥æ­£ç¢ºè¨­å®šã€‚</li>
    <li>åŸ·è¡Œ <code>exportfs -ra</code> æ›´æ–°å°å‡ºæ¸…å–®ã€‚</li>
    <pre><code>sudo exportfs -ra</code></pre>
    <li>å†æ¬¡å˜—è©¦å¾å®¢æˆ¶ç«¯æ›è¼‰ã€‚</li>
  </ol>
</div>

<h3>âœ… 2. æª¢æŸ¥ NFS æœå‹™æ˜¯å¦æ­£åœ¨é‹è¡Œ</h3>

<p>åœ¨ Server ç«¯ç¢ºèª NFS æœå‹™æœ‰å•Ÿå‹•ï¼š</p>

<pre><code>sudo systemctl status nfs-kernel-server</code></pre>

<p>å¦‚æœæ²’å•Ÿå‹•ï¼Œå•Ÿå‹•å®ƒï¼š</p>

<pre><code>sudo systemctl start nfs-kernel-server
sudo systemctl enable nfs-kernel-server</code></pre>

<h3>âœ… 3. æª¢æŸ¥é˜²ç«ç‰†è¨­å®šï¼ˆServer å’Œ Clientï¼‰</h3>

<p>Server ä¸Šå¯èƒ½æœ‰é˜²ç«ç‰†ï¼ˆå¦‚ <code>ufw</code> æˆ– <code>iptables</code>ï¼‰é˜»æ­¢äº† NFS è¨Šè™Ÿã€‚</p>

<p>æ”¾è¡Œ NFS æ‰€éœ€çš„åŸ è™Ÿï¼ˆé€šå¸¸æ˜¯ 2049ï¼‰ï¼š</p>

<pre><code>sudo ufw allow from 192.168.0.0/24 to any port 2049</code></pre>

<p>å¦‚æœä½¿ç”¨å…¶ä»– NFS ç›¸é—œæœå‹™æˆ– rpcbindï¼Œä¹Ÿéœ€è¦é–‹æ”¾ç›¸æ‡‰åŸ è™Ÿã€‚</p>

<h3>âœ… 4. æª¢æŸ¥ RPC/NFS æœå‹™æ˜¯å¦æ­£å¸¸é‹ä½œ</h3>

<p>åœ¨å®¢æˆ¶ç«¯åŸ·è¡Œï¼š</p>

<pre><code>rpcinfo -p 192.168.0.100</code></pre>

<p>æ‡‰è©²æœƒçœ‹åˆ°ä¸€å † NFS ç›¸é—œçš„æœå‹™è³‡è¨Šã€‚å¦‚æœçœ‹ä¸åˆ°ï¼Œè¡¨ç¤º NFS æœå‹™æœªæ­£ç¢ºå•Ÿå‹•æˆ–ç¶²è·¯ä¸é€šã€‚</p>

<h3>âœ… 5. ä½¿ç”¨ <code>-o nolock</code> é¿å…é–å®šå•é¡Œï¼ˆå¯é¸ï¼‰</h3>

<p>å¶çˆ¾å¯ä»¥åŠ ä¸Šé€™å€‹åƒæ•¸é¿å…é–å®šè¡çªï¼š</p>

<pre><code>sudo mount -t nfs -o nolock 192.168.0.100:/home/wheeltec/wheeltec_robot /mnt</code></pre>

<hr>

<h2>ğŸ§ª æ¸¬è©¦å°æŠ€å·§</h2>

<p>æ‚¨å¯ä»¥åœ¨ Server ç«¯è‡ªå·±æ›è¼‰çœ‹çœ‹æ˜¯å¦æ­£å¸¸ï¼š</p>

<pre><code>sudo mount --bind /home/wheeltec/wheeltec_robot /mnt</code></pre>

<p>è‹¥èƒ½æˆåŠŸï¼Œè¡¨ç¤ºè³‡æ–™å¤¾å­˜åœ¨ä¸”ç„¡å•é¡Œã€‚</p>

<hr>

<h2>ğŸ“Œ ç¸½çµæ­¥é©Ÿï¼ˆå¿«é€Ÿè™•ç†æµç¨‹ï¼‰</h2>

<ol>
  <li>ç™»å…¥ Server (<code>192.168.0.100</code>)</li>
  <li>ç¢ºèª <code>/etc/exports</code> æœ‰æ­£ç¢ºå°å‡ºç›®æ¨™ç›®éŒ„èˆ‡å®¢æˆ¶ç«¯ IPã€‚</li>
  <li>åŸ·è¡Œ <code>sudo exportfs -ra</code></li>
  <li>ç¢ºä¿ NFS æœå‹™å·²å•Ÿå‹•ï¼š<code>systemctl status nfs-kernel-server</code></li>
  <li>æª¢æŸ¥é˜²ç«ç‰†è¨­å®šã€‚</li>
  <li>å›åˆ°å®¢æˆ¶ç«¯å†æ¬¡åŸ·è¡Œ mount æŒ‡ä»¤ã€‚</li>
</ol>

<hr>

<p>å¦‚æœæ‚¨æä¾›æ›´å®Œæ•´çš„éŒ¯èª¤è¨Šæ¯ï¼ˆä¾‹å¦‚å®Œæ•´éŒ¯èª¤æ–‡å­—ï¼‰ï¼Œæˆ‘å¯ä»¥å¹«æ‚¨æ›´ç²¾æº–åˆ¤æ–·åŸå› ã€‚</p>

<p>éœ€è¦æˆ‘å”åŠ©å¯« <code>/etc/exports</code> çš„ç¯„ä¾‹å—ï¼Ÿ</p>

</body>
</html>